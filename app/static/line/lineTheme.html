<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>**政务中心排队系统</title>
    <!-- import element-ui CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!--<link rel="stylesheet" href="./src/css/element-ui.css">-->
    <!--less-->
    <link rel="stylesheet/less" type="text/css" href="./src/css/styles1.less" >
    <!--<link rel="stylesheet/less" type="text/css" href="css/index.less" >-->
    <script src="./src/js/less.min.js" type="text/javascript"></script>
    <!--axios-->
    <script src="./src/js/axios.min.js"></script>
</head>
<body>
<div id="XJList"  v-cloak>
    <div class="webHeader">
        <el-row class="one-btn">
            <el-button v-if="homeVisible" @click="homeBtnClick" type="primary" round class="home-btn" icon="el-icon-star-off">首页</el-button>
            <el-button v-if="backVisible" @click="backBtnClick" type="warning" round class="back-btn" icon="el-icon-back">返回</el-button>
        </el-row>
        <el-row class="topTitle"><h3>{{Title}}</h3></el-row>
    </div>

    <div class="webContent">
        <div class="webNav">
            <div class="curWay">{{curWay}}</div>
            <div class="curPos">{{curPos}}</div>
        </div>
        <div class="groupBtn">
            <!--themeBtn-->
            <el-row :gutter="30" class="themeBtnToNext" v-show="isTheme">
                <el-col :xs="12" :sm="8" v-for="(item,index) in curThemeList">
                    <el-button-group>
                        <el-button :type="((item.name==curTheme)? 'warning' : 'primary')" @click="themeBtnClick(item.name)">
                            <div class="themeName">
                                <div class="themeNameTextWarp">
                                    <div class="themeNameText">
                                        <p style="margin: 0;">{{item.name}}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="themeWait">{{item.wait}}人</div>
                        </el-button>
                    </el-button-group>
                </el-col>
            </el-row>
        </div>

        <div class="webFooter">
            <div class="footerBtn">
                <!--themeFooter btn-->
                <el-row :gutter="20" v-show="(themeList.length>pageMaxNum)" class="themeFooterBtn">
                    <el-col :span="3" :offset="8">
                        <el-button :type="((curPageNum==1)? 'info' : 'warning')" @click="leftList"><i class="el-icon-arrow-left el-icon--left"></i>上一页</el-button>
                    </el-col>
                    <el-col :span="3" :offset="2">
                        <el-button :type="((curPageNum>=total)? 'info' : 'warning')" @click="rightList">下一页<i class="el-icon-arrow-right el-icon--right"></i></el-button>
                    </el-col>
                </el-row>
            </div>
            <div class="timeOut" v-show="timeShow">本页面将在<span style="color:rgb(255,67,68);">{{timeOut}}s</span>后返回首页</div>
        </div>

    </div>
</div>
</body>
<!-- import Vue before Element -->
<script src="./src/js/vue.min.js"></script>
<!-- import element JavaScript -->
<!--<script src="./src/js/element.min.js"></script>-->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>
    /**
     * 获取对应名称的cookie
     * @param name cookie的名称
     * @returns {null} 不存在时，返回null
     */
    var getCookie = function (name) {
        var arr;
        var reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
        if (arr = document.cookie.match(reg))
            return arr[2];
        else
            return null;
    };
    const curUlr="http://119.23.187.168:8000";

    var XJline=new Vue({
        el: '#XJList',

        data: function() {
            return {
                // title
                homeLink: "/line/lineHome.html",
                homeVisible: true,
                backLink: "/line/lineHome.html",
                backVisible: true,
                Title: "**政务中心排队系统",

                // nav
                curWay: "现场取号",
                curPos: "按主题",

                // content
                // theme
                isTheme: true,
                themeList: [],
                curTheme: '',
                curMatter: '',

                curPageNum: 1,
                pageMaxNum: 12,

                // timeOut
                timeShow: true,
                timeOut: 60,
            }
        },
        created: function(){
            let _this = this;
            let self=this;
            var timer=setTimeout(function(){
                _this.notifyFn('提示', '请求超时')
                setTimeout(function(){
                    window.location.reload();
                }, 1000)
            },10000);
            var url = curUlr+'/subjects';

            axios.get(url,{
                params: {
                    work_addr: localStorage.addr
                },
                withCredentials: true
            }).then(function (result) {
                clearTimeout(timer);// 清除超时请求
                if(result.data.errno=='0'){
                    console.log(result.data.data.subjects);
                    _this.themeList=result.data.data.subjects;
                }else{
                    _this.notifyFn('提示', result.data.errmsg)
                    // setTimeout(function(){
                    //     window.location.reload();
                    // }, 2000)
                    // _this.loadAdderDialogVisible=true;
                }
            }).catch(function (error) {
                _this.notifyFn('提示', '服务器错误')
                console.log(error);
            });

            this.curTheme=localStorage.XJLineTheme;
            this.curMatter=localStorage.XJLineMatter;

            // 倒计时
            setInterval(function(){
                if(self.timeOut==0){
                    self.timeOut=0;
                    localStorage.XJLineTheme='';
                    localStorage.XJLineMatter='';
                    window.location.href='/line/lineHome.html';
                }else{
                    self.timeOut--;
                }
            },1000);

        },
        computed :{
            total: function(){
                return Math.ceil(this.themeList.length/this.pageMaxNum);
            },
            curThemeList: function(){
                return this.themeList.slice((this.curPageNum-1)*this.pageMaxNum, (this.curPageNum-1)*this.pageMaxNum+this.pageMaxNum);
            }
        },
        methods:{
            homeBtnClick: function(){
                localStorage.XJLineTheme='';
                localStorage.XJLineMatter='';
                window.location.href='/line/lineHome.html';
            },
            backBtnClick: function(){
                localStorage.XJLineTheme='';
                localStorage.XJLineMatter='';
                window.location.href='/line/lineHome.html';
            },
            themeBtnClick: function(aa){
                // alert(aa);
                localStorage.XJLineTheme=aa;
                localStorage.XJLineMatter='';
                window.location.href='/line/lineMatter.html';
            },
            leftList: function(){
                if(this.curPageNum<=1){
                    this.curPageNum=this.curPageNum;
                }else{
                    this.curPageNum=this.curPageNum-1;
                }
            },
            rightList: function(){
                if(this.curPageNum>=this.total){
                    this.curPageNum=this.curPageNum;
                }else{
                    this.curPageNum=this.curPageNum+1;
                }
            },
            notifyFn (title, msg, type = 'warning') {
                this.$notify({
                    title: title,
                    message: msg,
                    type: type,
                    dangerouslyUseHTMLString: true,
                    duration: 5000,
                    position: 'top-right'
                })
            }
        }
    })
</script>
</html>
