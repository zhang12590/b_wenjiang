<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>**政务中心排队系统</title>
    <!-- import element-ui CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!--less-->
    <link rel="stylesheet/less" type="text/css" href="./src/css/styles1.less" >
    <!--<link rel="stylesheet/less" type="text/css" href="css/index.less" >-->
    <script src="./src/js/less.min.js" type="text/javascript"></script>
    <!--axios-->
    <script src="./src/js/axios.min.js"></script>
    <!--self css-->
    <!--<link rel="stylesheet/less" type="text/css" href="css/styles1.less" >-->
</head>
<body>
<div id="XJList"  v-cloak>
    <div class="webHeader">
        <el-row class="one-btn">
            <el-button v-if="homeVisible" @click="homeBtnClick" type="primary" round class="home-btn" icon="el-icon-star-off">首页</el-button>
            <el-button v-if="backVisible" @click="backBtnClick" type="warning" round class="back-btn" icon="el-icon-back">返回</el-button>
        </el-row>
        <el-row class="topTitle"><h3>{{Title}}</h3></el-row>
    </div>

    <div class="webContent">
        <div class="webNav">
            <div class="curWay">{{curWay}}</div>
            <div class="curPos">{{curPos}}</div>
        </div>
        <div class="groupBtn">
            <!--matterBtn-->
            <el-row :gutter="30" class="matterBtnToNext" v-show="isMatter">
                <el-col :xs="12" :sm="8" v-for="(item,index) in curMatterList">
                    <el-button-group>
                        <el-button :type="((item.name==curMatter) ? 'warning' : 'primary')" @click="matterBtnClick(item.name)" >
                            <p style="margin: 0;">{{item.name}}</p>
                        </el-button>
                    </el-button-group>
                </el-col>
            </el-row>
        </div>

        <div class="webFooter">
            <div class="footerBtn">
                <!--matterFooter btn-->
                <el-row :gutter="20" v-show="(matterList.length>pageMaxNum)" class="themeFooterBtn">
                    <el-col :span="3" :offset="8">
                        <el-button :type="((curPageNum==1)? 'info' : 'warning')" @click="leftList"><i class="el-icon-arrow-left el-icon--left"></i>上一页</el-button>
                    </el-col>
                    <el-col :span="3" :offset="2">
                        <el-button :type="((curPageNum>=total)? 'info' : 'warning')" @click="rightList">下一页<i class="el-icon-arrow-right el-icon--right"></i></el-button>
                    </el-col>
                </el-row>
            </div>
            <div class="timeOut" v-show="timeShow">本页面将在<span style="color:rgb(255,67,68);">{{timeOut}}s</span>后返回首页</div>
        </div>

    </div>
</div>
</body>
<!-- import Vue before Element -->
<script src="./src/js/vue.min.js"></script>
<!-- import element JavaScript -->
<!--<script src="./src/js/element.min.js"></script>-->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>
    const curUlr="http://119.23.187.168:8000";
    var XJline=new Vue({
        el: '#XJList',

        data: function() {
            return {
                // title
                homeLink: "/line/lineHome.html",
                homeVisible: true,
                backLink: "/line/lineTheme.html",
                backVisible: true,
                Title: "**政务中心排队系统",

                // nav
                curWay: "现场取号",
                curPos: "按事项",

                //matter
                isMatter: true,
                matterList: [],
                curTheme: '',
                curMatter: '',

                curPageNum: 1,
                pageMaxNum: 12,

                // timeOut
                timeShow: true,
                timeOut: 60,
            }
        },
        created: function(){
            let _this = this;
            var timer=setTimeout(function(){
                // _this.$alert('请求超时', '警告', {
                //     confirmButtonText: '确定',
                //     callback: action => {
                //     }
                // });
                _this.notifyFn('提示', '请求超时')
                setTimeout(function(){
                    window.location.reload();
                }, 2000)
            },10000);
            let url= curUlr+"/items";
            axios.get(url,{
                params: {
                    subject: localStorage.XJLineTheme,
                    work_addr: localStorage.addr
                },
                withCredentials: true
            }).then(function (result) {
                clearTimeout(timer);
                console.log(result);
                if(result.data.errno=='0'){
                    console.log(result.data.data.items);
                    _this.matterList=result.data.data.items;
                }else{
                    _this.notifyFn('提示', result.data.errmsg)
                    setTimeout(function(){
                        window.location.reload();
                    }, 2000)
                }
            }).catch(function (error) {
                _this.notifyFn('提示', '服务器错误')
                console.log(error);
            });

            this.curTheme=localStorage.XJLineTheme;
            this.curMatter=localStorage.XJLineMatter;

            var self=this;
            // 倒计时
            setInterval(function(){
                if(self.timeOut==0){
                    self.timeOut=0;
                    localStorage.XJLineTheme='';
                    localStorage.XJLineMatter='';
                    window.location.href='/line/lineHome.html';
                }else{
                    self.timeOut--;
                }
            },1000)

        },
        computed :{
            total: function(){
                return Math.ceil(this.matterList.length/this.pageMaxNum);
            },
            curMatterList: function(){
                return this.matterList.slice((this.curPageNum-1)*this.pageMaxNum, (this.curPageNum-1)*this.pageMaxNum+this.pageMaxNum);
            }
        },
        methods:{
            homeBtnClick: function(){
                localStorage.XJLineTheme='';
                localStorage.XJLineMatter='';
                window.location.href='/line/lineHome.html';
            },
            backBtnClick: function(){
                // localStorage.XJLineTheme='';
                localStorage.XJLineMatter='';
                window.location.href='/line/lineTheme.html';
            },
            matterBtnClick: function(aa){
                localStorage.XJLineMatter=aa;

                sessionStorage.IDInfo='';// 清空ID信息
                window.location.href='/line/lineRegister.html';
            },
            leftList: function(){
                if(this.curPageNum <= 1){
                    this.curPageNum = 1;
                }else{
                    this.curPageNum = this.curPageNum-1;
                }
            },
            rightList: function(){
                if(this.curPageNum >= this.total){
                    this.curPageNum = this.total;
                }else{
                    this.curPageNum=this.curPageNum+1;
                }
            },
            notifyFn (title, msg, type = 'warning') {
                this.$notify({
                    title: title,
                    message: msg,
                    type: type,
                    dangerouslyUseHTMLString: true,
                    duration: 5000,
                    position: 'top-right'
                })
            }
        }
    })
</script>
</html>
