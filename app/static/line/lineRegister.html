<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>**政务中心排队系统</title>
    <!-- import element-ui CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!--less-->
    <link rel="stylesheet/less" type="text/css" href="./src/css/styles1.less" >
    <script src="./src/js/less.min.js" type="text/javascript"></script>
    <!-- jQuery -->
    <script src="./src/js/jquery-1.8.3.min.js"></script>
    <!--读取身份证-->
    <script type="text/javascript" src="./src/js/jquery.jBox-2.3.min.js"></script>
    <script type="text/javascript" src="./src/js/baseISSObject.js"></script>
    <script type="text/javascript" src="./src/js/baseISSOnline.js"></script>
    <script type="text/javascript" src="./src/js/commonID.js"></script>
    <script src="./src/js/LodopFuncs.js"></script>
    <!--axios-->
    <script src="./src/js/axios.min.js"></script>
    <style>
        .btnWarp{
            height: 8vh;
            /*line-height: 8vh;*/
            margin-bottom: 1vh;
            border-left: 1vh solid transparent;
        }
        .btnWarp:nth-child(12),.btnWarp:nth-child(10),.btnWarp:nth-child(11){
            margin-bottom: 0;
        }
        .idBtn{
            width: 100%;
            height:100%;
            font-size: 4vh;
        }
        .idClearBtn{
            margin-top: 1vh;
            /*margin-left: 0;*/
            height: 8vh;
            width: 100%;
            font-size: 4vh;
        }
        .el-button+.el-button {
            margin-left: 0;
        }
        .numBtnWarp{
            padding:0 1vw 6vh 1vw;
        }
        .el-dialog__headerbtn .el-dialog__close {
            color: #121313;
            font-size: 40px;
        }
        input::-webkit-input-placeholder { /* WebKit, Blink, Edge */
            color: #999;
            font-size: 30px;
        }
        input:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
            color: #999;
            font-size: 30px;
        }
        input::-moz-placeholder { /* Mozilla Firefox 19+ */
            color: #999;
            font-size: 30px;
        }
        input:-ms-input-placeholder { /* Internet Explorer 10-11 */
            color: #999;
            font-size: 30px;
        }
    </style>
</head>
<body>
<div id="XJList"  v-cloak>
    <div class="webHeader">
        <el-row class="one-btn">
            <el-button v-if="homeVisible" @click="homeBtnClick" type="primary" round class="home-btn" icon="el-icon-star-off">首页</el-button>
            <el-button v-if="backVisible" @click="backBtnClick" type="warning" round class="back-btn" icon="el-icon-back">返回</el-button>
        </el-row>
        <el-row class="topTitle"><h3>{{Title}}</h3></el-row>
    </div>

    <div class="webContent">
        <div class="webNav">
            <div class="curWay">{{curWay}}</div>
            <div class="curPos">{{curPos}}</div>
        </div>
        <div class="groupBtn">
            <!--register form-->
            <div class="registerForm" v-if="false">
                <div class="formID">
                    <el-input @input="inputIDChangeFn(inputIdText)" placeholder="请输入身份证号" :disabled="disabledID" v-model="inputIdText" :autofocus="inputIdFocus">
                        <template slot="prepend">身份证号</template>
                    </el-input>
                    <div class="errorTipID" v-show="errorID"><i class="el-icon-close"></i></div>
                    <div class="rightTipID" v-show="rightID"><i class="el-icon-check"></i></div>
                </div>
                <div class="formTel">
                    <el-input @input="inputTelChangeFn(inputTelText)" placeholder="请输入电话号码" v-model="inputTelText" :autofocus="inputTelFocus">
                        <template slot="prepend">电话号码</template>
                    </el-input>
                    <div class="errorTipTel" v-show="errorTel"><i class="el-icon-close"></i></div>
                    <div class="rightTipTel" v-show="rightTel"><i class="el-icon-check"></i></div>
                </div>
            </div>

        </div>

        <div class="webFooter">
            <div class="footerBtn">
                <!--matterFooter btn-->
                <el-row :gutter="20" class="themeFooterBtn" v-if="false">
                    <el-col :span="6" :offset="9">
                        <el-button type="primary" :disabled="!pBtnDisabled" @click.once="printingClick">打印排号</el-button>
                    </el-col>
                </el-row>
            </div>
            <div class="timeOut" v-show="timeShow">本页面将在<span style="color:rgb(255,67,68);">{{timeOut}}s</span>后返回首页</div>
        </div>
    </div>

    <div class="registerDialogWarp">
        <el-dialog
                title="请刷身份证"
                :visible.sync="centerDialogVisible"
                width="80vw"
                :close-on-click-modal="closeOnClickModal"
                center
                class="registerDialog"
        >
            <div class="dialogImg">
                <div style="background: url('/static/line/src/images/IDBG.png');" class="imgBG">
                </div>
            </div>
            <!--<span>需要注意的是内容是默认不居中的</span>-->
            <div style="text-align: center;font-size: 32px;font-weight: bold;color:rgba(0,0,0,0.8);">请将您的身份证放在指定位置</div>
            <span slot="footer" class="dialog-footer" v-show="isInputID">
                <span style="font-size: 16px;color: #b5b5b5;">忘带身份证？</span></br>
                <el-button type="warning" @click="centerDialogVisible = false ;idDialogVisible = true;">点击此处输入身份证号</el-button>
            </span>
        </el-dialog>
    </div>

    <div class="idDialogWarp">
        <el-dialog
                title="输入身份证号"
                :visible.sync="idDialogVisible"
                width="80vw"
                :show-close="true"
                :close-on-click-modal="closeOnClickModal"
                center
                class="idDialog"
        >
            <el-steps :active="1" finish-status="success" align-center>
                <el-step title="身份证"></el-step>
                <el-step title="电话"></el-step>
                <el-step title="提交"></el-step>
            </el-steps>
            <div class="formID">
                <el-input  @input="inputID1ChangeFn(inputIdStep)" placeholder="请输入身份证号" :disabled="disabledID" v-model="inputIdStep" :autofocus="inputIdFocus" disabled>
                    <template slot="append">身份证号</template>
                </el-input>
                <div class="errorTipID" v-show="errorID1"><i class="el-icon-close"></i></div>
                <div class="rightTipID" v-show="rightID1"><i class="el-icon-check"></i></div>
            </div>
            <div class='numBtnWarp'>
                <el-row :gutter="20">
                    <el-col :span="18">
                        <el-row :gutter="0">
                            <el-col v-for="(item) in 9" :span="8" class="btnWarp"><el-button @click="pushIdFn(item)" type="primary" class="idBtn">{{ item }}</el-button></el-col>
                            <el-col :span="8" class="btnWarp">
                                <!--<el-button @click="minusIdFn" type="primary" class="idBtn">删除</el-button>-->
                                <el-button @click="pushIdFn('X')" type="primary" class="idBtn">X</el-button>
                            </el-col>
                            <el-col :span="8" class="btnWarp">
                                <el-button @click="pushIdFn(0)" type="primary" class="idBtn">0</el-button>
                            </el-col>
                            <el-col :span="8" class="btnWarp">
                                <!--<el-button @click="clearIdFn" type="primary" class="idBtn">清空</el-button>-->
                                <el-button @click="minusIdFn" type="primary" class="idBtn">删除</el-button>
                            </el-col>
                        </el-row>
                    </el-col>
                    <el-col :span="6">
                        <el-button @click="rightIdFn" :disabled="isRightID" type="primary" class="idBtn" style="height:26vh;line-height:5vh;">
                            <span>确</span></br><span>认</span>
                        </el-button>
                        <el-button @click="clearIdFn" type="primary" class="idClearBtn">清空</el-button>
                    </el-col>
                </el-row>
            </div>


        </el-dialog>
    </div>

    <div class="telDialogWarp">
        <el-dialog
                title="输入电话号码"
                :visible.sync="telDialogVisible"
                width="80vw"
                :show-close="true"
                :close-on-click-modal="closeOnClickModal"
                center
                class="telDialog"
        >
            <el-steps :active="telAction" finish-status="success" align-center>
                <el-step title="身份证"></el-step>
                <el-step title="电话"></el-step>
                <el-step title="提交"></el-step>
            </el-steps>
            <div class="formID">
                <el-input  @input="inputTel1ChangeFn(inputTelStep)" placeholder="请输入电话号码" :disabled="disabledID" v-model="inputTelStep" disabled>
                    <template slot="append">电话号码</template>
                </el-input>
                <div class="errorTipID" v-show="errorTel1"><i class="el-icon-close"></i></div>
                <div class="rightTipID" v-show="rightTel1"><i class="el-icon-check"></i></div>
            </div>
            <div class='numBtnWarp'>
                <el-row :gutter="20">
                    <el-col :span="18">
                        <el-row :gutter="0">
                            <el-col v-for="(item) in 9" :span="8" class="btnWarp"><el-button @click="pushTelFn(item)" type="primary" class="idBtn">{{ item }}</el-button></el-col>
                            <el-col :span="8" class="btnWarp">
                                <el-button @click="minusTelFn" type="primary" class="idBtn">删除</el-button>
                            </el-col>
                            <el-col :span="8" class="btnWarp">
                                <el-button @click="pushTelFn(0)" type="primary" class="idBtn">0</el-button>
                            </el-col>
                            <el-col :span="8" class="btnWarp">
                                <el-button @click="clearTelFn" type="primary" class="idBtn">清空</el-button>
                            </el-col>
                        </el-row>
                    </el-col>
                    <el-col :span="6">
                        <el-button @click="rightTelFn" :disabled="isRightTel" type="primary" class="idBtn" style="height:35vh;line-height:5vh;">
                            <span>打</span></br><span>印</span></br><span>排</span></br><span>号</span>
                        </el-button>
                    </el-col>
                </el-row>
            </div>


        </el-dialog>
    </div>

    <!--完成后-->
    <el-dialog title="提示" :visible.sync="didDialog1Visible"
            width="50vw" top="30vh"
            :show-close="showClose" :close-on-click-modal="closeOnClickModal"
            class="didDialog"
    >
        <div style="text-align: center;font-size: 20px;font-weight: bold;color:rgba(0,0,0,0.8);margin-top:10px;">请收好您的身份证，取走小票</div>
        <span slot="footer" class="dialog-footer" v-show="isInputID">
            <el-button type="warning" @click="makeSureIDFn" style="font-size: 20px;">确 定</el-button>
            </span>
    </el-dialog>
    <el-dialog title="提示" :visible.sync="didDialog2Visible"
               width="50vw" top="30vh"
               :show-close="showClose" :close-on-click-modal="closeOnClickModal"
               class="didDialog"
    >
        <div style="text-align: center;font-size: 20px;font-weight: bold;color:rgba(0,0,0,0.8);margin-top:10px;">请取走您的小票</div>
        <span slot="footer" class="dialog-footer" v-show="isInputID">
            <el-button type="warning" @click="makeSureIDFn" style="font-size: 20px;">确 定</el-button>
            </span>
    </el-dialog>
</div>
</body>
<!-- import Vue before Element -->
<script src="./src/js/vue.min.js"></script>
<!-- import element JavaScript -->
<!--<script src="./src/js/element.min.js"></script>-->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>
    // 时间
    function clockFn(){
        var now = new Date();
        var year = now.getFullYear(); //getFullYear getYear
        var month = now.getMonth();
        var date = now.getDate();
        var day = now.getDay();
        var hour = now.getHours();
        var minu = now.getMinutes();
        var sec = now.getSeconds();
        var week;
        month = month + 1;
        if (month < 10) month = "0" + month;
        if (date < 10) date = "0" + date;
        if (hour < 10) hour = "0" + hour;
        if (minu < 10) minu = "0" + minu;
        if (sec < 10) sec = "0" + sec;
        var arr_week = new Array("星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六");
        week = arr_week[day];
        var time = "";
        time = year + "-" + month + "-" + date + " " + hour + ":" + minu + ":" + sec;
        return(time);
    }

    var LODOP; //声明为全局变量
    function CreateOneFormPage1(obj){
        var contentW = 260;
        var contentH = 25;
        var QW = 274;
        var QH = 46;
        var leftOff = 8;

        LODOP=getLodop();
        // 画一个名片大小的矩形边框
        // 边框离纸张顶端10px(px是绝对值长度，等于1/96英寸,下同)距左边55px、宽360px、高220px、
        // 框为实线(0-实线 1-破折线 2-点线 3-点划线 4-双点划线)、线宽为1px
        // LODOP.ADD_PRINT_RECT(10,55,360,329,0,1);
        // LODOP.PRINT_INIT("打印控件功能演示_Lodop功能_表单一");
        LODOP.SET_PRINT_STYLE("FontSize",14);// 字体大小,单位是pt
        LODOP.SET_PRINT_STYLE("Bold",1);
        LODOP.SET_PRINT_STYLE("Alignment",2);
        // 离纸张顶端20px、距左边180px、宽100px、高25px、内容为 title
        LODOP.ADD_PRINT_TEXT(20,leftOff,contentW,contentH,obj.title);
        LODOP.SET_PRINT_STYLE("FontSize",12);// 字体大小,单位是pt
        LODOP.ADD_PRINT_TEXT(45,leftOff,contentW,contentH,obj.lineNumber);
        LODOP.SET_PRINT_STYLE("FontSize",11);// 字体大小,单位是pt
        LODOP.ADD_PRINT_TEXT(70,leftOff,contentW,contentH,obj.tips);
        LODOP.SET_PRINT_STYLE("Bold",0);
        LODOP.SET_PRINT_STYLE("Alignment",1);
        LODOP.ADD_PRINT_TEXT(95,leftOff,contentW,contentH,obj.theme);
        LODOP.ADD_PRINT_TEXT(120,leftOff,contentW,contentH,obj.waitNum);
        LODOP.ADD_PRINT_TEXT(145,leftOff,contentW,contentH,obj.windowLocation);
        LODOP.SET_PRINT_STYLE("Bold",1);
        LODOP.SET_PRINT_STYLE("Alignment",2);
        LODOP.ADD_PRINT_TEXT(176,leftOff,contentW,contentH,obj.curTime);
        LODOP.ADD_PRINT_BARCODE(206,leftOff,QW,QH,"EAN128A",obj.waterNUm);
        LODOP.SET_PRINT_STYLEA(0,"AlignJustify",2);
        LODOP.ADD_PRINT_BARCODE(273,leftOff,QW,QH,"EAN128A",obj.waterNUm);
        LODOP.SET_PRINT_STYLEA(0,"AlignJustify",2);
        LODOP.ADD_PRINT_TEXT(320,leftOff,contentW,contentH,'');

        LODOP.PRINT();// 直接打印
        // LODOP.PREVIEW();// 打印预览
        // LODOP.PRINT_DESIGN();// 打印设计
    };
    const curUlr="http://119.23.187.168:8000";

    var XJline=new Vue({
        el: '#XJList',

        data: function(){
            return {
                // title
                homeLink: "/line/lineHome.html",
                homeVisible: true,
                backLink: "/line/lineMatter.html",
                backVisible: true,
                Title: "**政务中心排队系统",
                // nav
                curWay: "现场取号",
                curPos: "登记",

                // content
                curTheme: '',
                curMatter: '',

                // form
                inputIdText: '',
                inputTelText: '',

                inputIdFocus: false,
                disabledID: false,
                errorID: false,
                rightID: false,

                inputTelFocus: false,
                errorTel: false,
                rightTel: false,


                // timeOut
                timeShow: true,
                timeOut: 60,

                // dialog
                centerDialogVisible: true,
                showClose: false,
                closeOnClickModal: false,
                isInputID: true,

                // didDialog
                didDialog1Visible: false,
                didDialog2Visible: false,
                isBrush: false,

                // reback Data
                windowLocation: '二楼004窗口',
                LineNumber: 'A001',
                waterNum: 'a201902261801',
                waitNum: 1,
                curTime: '2019-02-26 10:34:32',

                IDInfo: {},

                idDialogVisible: false,
                inputIdStep: '',
                isRightID: true,
                errorID1: false,
                rightID1: false,

                telDialogVisible: false,
                inputTelStep: '',
                isRightTel: true,
                errorTel1: false,
                rightTel1: false,
                telAction: 2
            }
        },
        wacth:{
            rightID: function(val) {
                this.rightID = val
                if(this.rightID) {
                    this.isRightID =false
                }
            }
        },
        created: function(){
            //请求数据
            this.curTheme=localStorage.XJLineTheme;
            this.curMatter=localStorage.XJLineMatter;

            var self=this;
            var IDReg=/(^\d{18}$)|(^\d{17}(\d|[A-X]|[a-x])$)/;
            var IDTimer=setInterval(function(){
                new Device().startFun();
                if(sessionStorage.IDInfo){
                    self.IDInfo=JSON.parse(sessionStorage.IDInfo);
                    console.log(self.IDInfo.Certificate.IDNumber);
                    if(-1==self.IDInfo.Certificate.IDNumber.search(IDReg)){
                        // 读取有误
                        console.log(0);
                        self.$alert('身份证读取有误，请重新试试', '警告', {
                            confirmButtonText: '确定',
                            callback: action => {
                                // window.location.href='/line/lineHome.html';
                            }
                        });
                    }else{
                        // 正确
                        console.log(1);
                        console.log(self.IDInfo);
                        clearTimeout(IDTimer);
                        self.centerDialogVisible=false;// box miss
                        self.inputIdText=self.IDInfo.Certificate.IDNumber;
                        // self.disabledID=true;
                        // self.rightID=true;
                        // self.errorID=false;
                        self.isBrush=true;
                        self.inputIdStep=self.IDInfo.Certificate.IDNumber;

                        var timer=setTimeout(function(){
                            self.$alert('请求超时', '警告', {
                                confirmButtonText: '确定',
                                callback: action => {
                                }
                            });
                        },10000);
                        let url= curUlr+"/search_phone";
                        axios.get(url,{
                            params: {
                                idno: self.inputIdStep,
                                work_addr: localStorage.addr
                            },
                            withCredentials: true
                        }).then(function (result) {
                            clearTimeout(timer);
                            console.log(result);
                            if(result.data.errno=='0'){
                                self.inputTelStep=result.data.data;
                                self.telDialogVisible= true

                                let aa=self.inputTelStep
                                // var telReg=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|17[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/;// 适用大部分
                                var Reg=/^\d{11}$/;// 只适配输入的多和少
                                if(aa==''){
                                    self.errorTel1= false;
                                    self.rightTel1= false;
                                    self.isRightTel = true
                                    self.telAction =2
                                }else if(-1==aa.search(Reg)){
                                    self.errorTel1= true;
                                    self.rightTel1= false;
                                    self.isRightTel = true
                                    self.telAction =2
                                }else if(0==aa.search(Reg)){
                                    self.errorTel1= false;
                                    self.rightTel1= true;
                                    self.isRightTel =false
                                    self.telAction =3
                                }
                            }else{
                                _this.notifyFn('提示', result.data.errmsg)
                                // setTimeout(function(){
                                //     window.location.reload();
                                // }, 2000)
                            }
                        }).catch(function (error) {
                            _this.notifyFn('提示', '服务器错误')
                            console.log(error);
                        });
                    }

                }else{

                }
            },3000);

            setInterval(function(){
                if(self.timeOut==0){
                    self.timeOut=0;
                    localStorage.XJLineTheme='';
                    localStorage.XJLineMatter='';

                    sessionStorage.IDInfo='';// 清空ID信息
                    window.location.href='/line/lineHome.html';
                }else{
                    self.timeOut--;
                }
            },1000);

        },
        computed :{
            pBtnDisabled: {
                get:function(){// 这里功能要添加-主题或事项没选的话-弹框
                    return (this.rightTel && this.rightID && this.curTheme && this.curMatter);
                }
            }

        },
        methods:{
            pushIdFn: function(num){
                this.inputIdStep+=num;
                let aa=this.inputIdStep
                var IDReg=/(^\d{18}$)|(^\d{17}(\d|[A-X]|[a-x])$)/;
                if(aa==''){
                    this.errorID1= false;
                    this.rightID1= false;
                    this.isRightID = true
                }else if(-1==aa.search(IDReg)){
                    this.errorID1= true;
                    this.rightID1= false;
                    this.isRightID = true
                }else if(0==aa.search(IDReg)){
                    this.errorID1= false;
                    this.rightID1= true;
                    this.isRightID =false
                }
            },
            minusIdFn() {
                this.inputIdStep = this.inputIdStep.substring(0,this.inputIdStep.length - 1)
                let aa=this.inputIdStep
                var IDReg=/(^\d{18}$)|(^\d{17}(\d|[A-X]|[a-x])$)/;
                if(aa==''){
                    this.errorID1= false;
                    this.rightID1= false;
                    this.isRightID = true
                }else if(-1==aa.search(IDReg)){
                    this.errorID1= true;
                    this.rightID1= false;
                    this.isRightID = true
                }else if(0==aa.search(IDReg)){
                    this.errorID1= false;
                    this.rightID1= true;
                    this.isRightID =false
                }
            },
            clearIdFn() {
                this.inputIdStep=''
                let aa=this.inputIdStep
                var IDReg=/(^\d{18}$)|(^\d{17}(\d|[A-X]|[a-x])$)/;
                if(aa==''){
                    this.errorID1= false;
                    this.rightID1= false;
                    this.isRightID = true
                }else if(-1==aa.search(IDReg)){
                    this.errorID1= true;
                    this.rightID1= false;
                    this.isRightID = true
                }else if(0==aa.search(IDReg)){
                    this.errorID1= false;
                    this.rightID1= true;
                    this.isRightID =false
                }
            },
            inputID1ChangeFn: function(aa){
                aa=aa.replace(/(\s*)/g,"");
                this.inputIdText=aa;
                // 输入时就验证
                var IDReg=/(^\d{18}$)|(^\d{17}(\d|[A-X]|[a-x])$)/;
                if(aa==''){
                    this.errorID1= false;
                    this.rightID1= false;
                    this.isRightID = true
                }else if(-1==aa.search(IDReg)){
                    this.errorID1= true;
                    this.rightID1= false;
                    this.isRightID = true
                }else if(0==aa.search(IDReg)){
                    this.errorID1= false;
                    this.rightID1= true;
                    this.isRightID =false
                }
            },
            rightIdFn() {
                this.idDialogVisible = false
                this.telDialogVisible = true
                console.log(this.inputIdStep)
                let self = this
                // self.inputIdStep=self.IDInfo.Certificate.IDNumber;

                var timer=setTimeout(function(){
                    self.$alert('请求超时', '警告', {
                        confirmButtonText: '确定',
                        callback: action => {
                        }
                    });
                },10000);
                let url= curUlr+"/search_phone";
            axios.get(url,{
                    params: {
                        idno: self.inputIdStep,
                        work_addr: localStorage.addr
                    },
                    withCredentials: true
                }).then(function (result) {
                    clearTimeout(timer);
                    console.log(result);
                    if(result.data.errno=='0'){
                        self.inputTelStep=result.data.data;
                        self.telDialogVisible= true

                        let aa=self.inputTelStep
                        var Reg=/^\d{11}$/;// 只适配输入的多和少
                        if(aa==''){
                            self.errorTel1= false;
                            self.rightTel1= false;
                            self.isRightTel = true
                            self.telAction =2
                        }else if(-1==aa.search(Reg)){
                            self.errorTel1= true;
                            self.rightTel1= false;
                            self.isRightTel = true
                            self.telAction =2
                        }else if(0==aa.search(Reg)){
                            self.errorTel1= false;
                            self.rightTel1= true;
                            self.isRightTel =false
                            self.telAction =3
                        }
                    }else{
                        _this.notifyFn('提示', result.data.errmsg)
                        // setTimeout(function(){
                        //     window.location.reload();
                        // }, 2000)
                    }
                }).catch(function (error) {
                    _this.notifyFn('提示', '服务器错误')
                    console.log(error);
                });
            },
            pushTelFn: function(num){
                this.inputTelStep+=num;
                let aa=this.inputTelStep
                // var telReg=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|17[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/;// 适用大部分
                var Reg=/^\d{11}$/;// 只适配输入的多和少
                if(aa==''){
                    this.errorTel1= false;
                    this.rightTel1= false;
                    this.isRightTel = true
                    this.telAction = 2
                }else if(-1==aa.search(Reg)){
                    this.errorTel1= true;
                    this.rightTel1= false;
                    this.isRightTel = true
                    this.telAction = 2
                }else if(0==aa.search(Reg)){
                    this.errorTel1= false;
                    this.rightTel1= true;
                    this.isRightTel =false
                    this.telAction = 3
                }
            },
            minusTelFn() {
                this.inputTelStep = this.inputTelStep.substring(0,this.inputTelStep.length - 1)
                let aa=this.inputTelStep
                // var telReg=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|17[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/;// 适用大部分
                var Reg=/^\d{11}$/;// 只适配输入的多和少
                if(aa==''){
                    this.errorTel1= false;
                    this.rightTel1= false;
                    this.isRightTel = true
                    this.telAction = 2
                }else if(-1==aa.search(Reg)){
                    this.errorTel1= true;
                    this.rightTel1= false;
                    this.isRightTel = true
                    this.telAction = 2
                }else if(0==aa.search(Reg)){
                    this.errorTel1= false;
                    this.rightTel1= true;
                    this.isRightTel =false
                    this.telAction = 3
                }
            },
            clearTelFn() {
                this.inputTelStep=''
                let aa=this.inputTelStep
                // var telReg=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|17[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/;// 适用大部分
                var Reg=/^\d{11}$/;// 只适配输入的多和少
                if(aa==''){
                    this.errorTel1= false;
                    this.rightTel1= false;
                    this.isRightTel = true
                    this.telAction = 2
                }else if(-1==aa.search(Reg)){
                    this.errorTel1= true;
                    this.rightTel1= false;
                    this.isRightTel = true
                    this.telAction = 2
                }else if(0==aa.search(Reg)){
                    this.errorTel1= false;
                    this.rightTel1= true;
                    this.isRightTel =false
                    this.telAction = 3
                }
            },
            inputTel1ChangeFn: function(aa){
                aa=aa.replace(/(\s*)/g,"");
                this.inputTelText=aa;
                var Reg=/^\d{11}$/;// 只适配输入的多和少
                if(aa==''){
                    this.errorTel1= false;
                    this.rightTel1= false;
                    this.isRightTel = true
                    this.telAction = 2
                }else if(-1==aa.search(Reg)){
                    this.errorTel1= true;
                    this.rightTel1= false;
                    this.isRightTel = true
                    this.telAction = 2
                }else if(0==aa.search(Reg)){
                    this.errorTel1= false;
                    this.rightTel1= true;
                    this.isRightTel =false
                    this.telAction = 3
                }
            },
            rightTelFn() {
                this.telDialogVisible = true
                console.log(this.inputTelStep)
                _this=this;
                this.timeOut=15;
                // 打印排队
                var timer=setTimeout(function(){
                    _this.$alert('请求超时', '警告', {
                        confirmButtonText: '确定',
                        callback: action => {
                            window.location.href='/line/lineHome.html';
                        }
                    });
                },10000);

                let url=curUlr+"/number";
                axios.post(url,{
                    subject : this.curTheme,
                    item : this.curMatter,
                    idno : this.inputIdStep,
                    mobile : this.inputTelStep,
                    work_addr: localStorage.addr
                }).then(function(res) {
                    clearTimeout(timer);// 清除超时请求
                    if(res.status==200){
                        console.log(res.status);
                        if(res.data.errno==0){
                            _this.windowLocation=res.data.data.location;
                            _this.LineNumber=res.data.data.number;
                            _this.waterNum=res.data.data.water_num;
                            _this.curTime=clockFn();
                            _this.waitNum= res.data.data.wait;
                            var obj ={
                                title: '**政务服务中心',
                                lineNumber: _this.LineNumber,
                                tips: '请注意短信提示,及时到窗口办理',
                                theme: '办理业务: '+_this.curTheme,
                                waitNum: '等待人数: '+_this.waitNum,
                                windowLocation: '办理窗口: '+_this.windowLocation,
                                curTime: _this.curTime,
                                waterNUm: _this.waterNum
                            };

                            __this=_this;
                            setTimeout(function(){
                                // prn1_print();
                                CreateOneFormPage1(obj);
                                if(__this.isBrush){
                                    __this.didDialog1Visible=true;
                                }else{
                                    __this.didDialog2Visible=true;
                                }
                            },40);
                        }else{
                            _this.notifyFn('提示', res.data.errmsg)
                            // setTimeout(function(){
                            //     window.location.reload();
                            // }, 2000)
                        }
                    }
                }).catch(function (error) {
                    _this.notifyFn('提示', '服务器错误')
                    console.log(error);
                });
            },
            homeBtnClick: function(){
                localStorage.XJLineTheme='';
                localStorage.XJLineMatter='';

                sessionStorage.IDInfo='';// 清空ID信息
                window.location.href='/line/lineHome.html';
            },
            backBtnClick: function(){
                sessionStorage.IDInfo='';// 清空ID信息
                window.location.href='/line/lineMatter.html';
            },
            // input ID
            inputIDChangeFn: function(aa){
                aa=aa.replace(/(\s*)/g,"");
                this.inputIdText=aa;
                // 输入时就验证
                var IDReg=/(^\d{18}$)|(^\d{17}(\d|[A-X]|[a-x])$)/;
                if(aa==''){
                    this.errorID= false;
                    this.rightID= false;
                }else if(-1==aa.search(IDReg)){
                    this.errorID= true;
                    this.rightID= false;
                }else if(0==aa.search(IDReg)){
                    this.errorID= false;
                    this.rightID= true;
                }
            },
            //input tel
            inputTelChangeFn: function(aa){
                aa=aa.replace(/(\s*)/g,"");
                this.inputTelText=aa;
                // 输入时就验证
                // var telReg=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|17[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/;// 适用大部分
                var telReg=/^\d{11}$/;// 只适配输入的多和少

                if(aa==''){
                    this.errorTel= false;
                    this.rightTel= false;
                }else if(-1==aa.search(telReg)){
                    this.errorTel= true;
                    this.rightTel= false;
                }else if(0==aa.search(telReg)){
                    this.errorTel= false;
                    this.rightTel= true;
                }
            },

            printingClick: function(){
                _this=this;
                this.timeOut=15;
                // 打印排队
                var timer=setTimeout(function(){
                    _this.$alert('请求超时', '警告', {
                        confirmButtonText: '确定',
                        callback: action => {
                            window.location.href='/line/lineHome.html';
                        }
                    });
                },10000);

                let url=curUlr+"/number";
                axios.post(url,{
                    subject : this.curTheme,
                    item : this.curMatter,
                    idno : this.inputIdText,
                    mobile : this.inputTelText,
                    work_addr: localStorage.addr
                }).then(function(res) {
                    clearTimeout(timer);// 清除超时请求
                    if(res.status==200){
                        console.log(res.status);
                        if(res.data.errno==0){
                            _this.windowLocation=res.data.data.location;
                            _this.LineNumber=res.data.data.number;
                            _this.waterNum=res.data.data.water_num;
                            _this.curTime=clockFn();
                            _this.waitNum= res.data.data.wait;
                            var obj ={
                                title: '**政务服务中心',
                                lineNumber: _this.LineNumber,
                                tips: '请注意短信提示,及时到窗口办理',
                                theme: '办理业务: '+_this.curTheme,
                                waitNum: '等待人数: '+_this.waitNum,
                                windowLocation: '办理窗口: '+_this.windowLocation,
                                curTime: _this.curTime,
                                waterNUm: _this.waterNum
                            };

                            __this=_this;
                            setTimeout(function(){
                                // prn1_print();
                                CreateOneFormPage1(obj);
                                if(__this.isBrush){
                                    __this.didDialog1Visible=true;
                                }else{
                                    __this.didDialog2Visible=true;
                                }
                            },40);
                        }else{
                            _this.notifyFn('提示', res.data.errmsg)
                            // setTimeout(function(){
                            //     window.location.reload();
                            // }, 2000)
                        }
                    }
                }).catch(function (error) {
                    _this.notifyFn('提示', '服务器错误')
                    console.log(error);
                });
            },
            makeSureIDFn: function(){
                window.location.href='/line/lineHome.html';
            },

        }
    });


</script>
</html>
